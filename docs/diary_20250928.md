# AXIUART Verification Diary – 2025-09-28

## Summary

- Investigated the persistent `Test timeout - simulation ran too long` failure seen after the UART monitor fixes.
- Determined that the 120 ms guard in `uart_axi4_tb_top` underestimated the execution time for long UART register campaigns at 115200 baud.
- Raised the simulation guard to a derived 400 ms window so the comprehensive register sequence can complete while preserving a deterministic stop condition.
- Re-ran the official regression flow via `run_uvm.ps1` (seed 12345) and confirmed the timeout UVM error is cleared.

## Root Cause Analysis

- Each UART frame serialises at 10 bits per byte, yielding ~86.8 µs per byte at 115200 baud.
- The comprehensive register sequence issues up to 175 UART transactions, including 23-byte burst writes and their responses.
- Worst-case runtime therefore exceeds 150 ms; the 120 ms guard clipped the run despite the DUT responding correctly.
- No missing responses were observed in the latest `dsim.log`; status frames (0x00/0x04/0x05) arrive with valid CRCs, so the failure was purely the external timeout condition.

## Implementation Details

- Added `localparam time SIM_TIMEOUT = 400ms;` to `sim/uvm/tb/uart_axi4_tb_top.sv` and reused it in the timeout block.
- Updated the timeout message to report the configured limit, improving post-mortem clarity.
- Chosen value covers the theoretical maximum (~320 ms for the current workload) with additional margin while avoiding indefinite simulations.

## Verification

- Command: `run_uvm.ps1 -TestName register_comprehensive_test -Seed 12345` (executed from `sim/uvm`).
- Result: exit code 0, `UVM_ERROR: 0`, wall-clock 56.03 s; simulation finished at 321.50015 ms without hitting the guard.
- Coverage summary from the run: frame 52.08 %, burst 46.88 %, error 100.00 %, total 66.32 % (warning retained for future coverage work).
- Scoreboard still flags unmatched UART transactions because the internal AXI monitor is passive; behaviour unchanged from prior runs and outside the current fix scope.

## Follow-up Recommendations

- Revisit scoreboard/AXI monitoring to eliminate the "Unmatched transactions remain" warning when internal AXI visibility becomes available.
- Consider scripting a dynamic timeout that scales with configured baud rate and expected transaction count for future scalability.

## Documentation Maintenance – 2025-09-28

- Refreshed `docs/comprehensive_work_instructions.md` with a concise goal/status summary, expanded checklists for daily work, and explicit simulation guidance tied to `run_uvm.ps1`.
- Converted operating procedures and completion gates into actionable markdown checklists to streamline hand-off reviews.
- Verified the document passes repository markdown linting after restructuring nested lists.
- No simulations executed for this update; existing regression artefacts remain valid.

### Next Actions

- Socialise the updated checklists with the wider team during the next stand-up and capture feedback for iterative refinement.

## Verification Session – 2025-09-28 20:29 JST

### Executed command (21:25 run)

- `sim/exec/run_uvm.ps1 -Mode run -TestName register_comprehensive_test -Seed 12345 -Verbosity UVM_MEDIUM -Waves on -Coverage on`

### Key results (21:25 run)

- `UVM_ERROR = 0`, `UVM_FATAL = 0`; `dsim.exe` exit code 0 after 61.19 s wall clock.
- Simulation time reached 321.50015 ms without triggering the timeout guard.
- Waveform captured at `archive/waveforms/register_comprehensive_test_20250928_202809.mxd`.
- Coverage database stored at `sim/exec/metrics.db`; HTML report regenerated under `sim/exec/coverage_report/`.
- Coverage summary from log: frame 52.08 %, burst 46.88 %, error 100.00 %, total 66.32 % (warning retained for future coverage work).
- Scoreboard emitted `Unmatched transactions remain in queues`; behaviour unchanged from prior runs and requires AXI monitor enhancements.

### Tooling updates and observations

- Rebuilt `sim/exec/run_uvm.ps1` to match the comprehensive work instructions: environment validation, automatic DSIM license detection, scoped coverage enablement, and MXD/metrics management now occur by default.
- Added directory handling so waveforms route directly into `archive/waveforms/` with timestamped filenames, keeping artefact bookkeeping consistent.
- Scoped coverage via `coverage_scope.specs` avoids the DSIM expression-coverage crash observed when collecting full hierarchy data.

### Follow-up items

- Investigate the scoreboard imbalance by instrumenting the AXI monitor path so responses match UART transactions.
- Expand register access sequences with additional alignment cases to continue pushing toggle coverage toward the 60 % Phase 4 target.

## Verification Session – 2025-09-28 21:25 JST

### Sequence adjustments

- Augmented `register_comprehensive_access_sequence` so the CONTROL register now exercises full-word writes through enable → disable → reset-only → enable cycles with extended dwell times.
- Added a secondary disable window to improve the odds of sampling `bridge_enable` low for the DUT-level expression coverage target.

### Executed command (22:19 run)

- `sim/exec/run_uvm.ps1 -Mode run -TestName register_comprehensive_test -Seed 12345 -Verbosity UVM_MEDIUM -Waves on -Coverage on`

### Key results (22:19 run)

- `UVM_ERROR = 0`, `UVM_FATAL = 0`; DSIM exited with code 0 after 47.2 s wall clock, finishing at 371.51529 ms of simulation time.
- New waveform archived at `archive/waveforms/register_comprehensive_test_20250928_212420.mxd`.
- Log captured under `sim/exec/logs/register_comprehensive_test_20250928_212420.log`; metrics database refreshed in `sim/exec/metrics.db` with HTML reports regenerated in `sim/exec/coverage_report/`.

### Coverage observations

- Functional coverage remains unchanged (frame 52.08 %, burst 46.88 %, error 100.00 %, total 66.32 %). DSIM still issues the <80 % warning as expected.
- Expression coverage on `AXIUART_Top.sv:56` continues to miss the `rst=0, bridge_enable=0` bin despite the added disable windows; toggle coverage column for the DUT is still blank.
- Follow-up: instrument or probe `bridge_enable` directly (e.g., via waveform review or targeted monitor) to confirm whether the register write is taking effect; if not, revisit the CONTROL write stimulus path.

### Additional notes

- Scoreboard continues to flag unmatched UART transactions because the AXI side is passive; behaviour matches prior runs and is outside today's scope.
- Captured artefacts satisfy the work-instructions archival requirements (waveform + coverage + log).

## Verification Session – 2025-09-28 22:19 JST

### Instrumentation to monitor `bridge_enable`

- Exposed `bridge_enable` and the full 8-bit `bridge_error_code` via new simulation-only ports on `rtl/AXIUART_Top.sv`; `system_ready` now derives from `bridge_error_code == 8'h00`.
- Added `sim/uvm/interfaces/bridge_status_if.sv` and published it from `uart_axi4_tb_top` alongside the UART virtual interface.
- Introduced `bridge_status_monitor` (UVM component with a covergroup and transition tracking) and plugged it into the environment when `enable_system_status_monitoring` is set.
- Updated `uart_axi4_test_pkg.sv`, `uart_axi4_env_config.sv`, `uart_axi4_env.sv`, and `uart_axi4_base_test.sv` so the new interface propagates through the config DB; refreshed `dsim_config.f` to compile the interface/monitor sources.
- Archived the compile/run adjustments in MXD/coverage outputs by rerunning the regression with the new hooks.

### Executed command

- `sim/exec/run_uvm.ps1 -Mode run -TestName register_comprehensive_test -Seed 12345 -Verbosity UVM_MEDIUM -Waves on -Coverage on`

### Key results

- `UVM_ERROR = 1` (single hit from `BRIDGE_MON`), `UVM_FATAL = 0`; DSIM exited with code 0 after 97.08 s wall clock, ending at 371.51529 ms of simulation time.
- `bridge_status_monitor` asserted an error because `bridge_enable` never deasserted; the covergroup reported only the steady-high bin as covered (no `1=>0` transition yet).
- Waveform archived at `archive/waveforms/register_comprehensive_test_20250928_221952.mxd`; coverage artefacts regenerated in `sim/exec/metrics.db` and `sim/exec/coverage_report/`.
- Functional coverage unchanged (frame 52.08 %, burst 46.88 %, error 100.00 %, total 66.32 %). Expression coverage at `AXIUART_Top` still misses the disabled state; toggle column remains blank.
- Scoreboard warnings about unmatched UART transactions persist (expected while AXI monitoring stays passive).

### Next investigations

- Correlate CONTROL register writes with readbacks to confirm whether the UART-driven write to 0x0000_1000 actually propagates to `Register_Block`.
- Inspect the AXI-lite master handshake during the disable window; if the bridge resets before the write commit, introduce a dedicated disable path (e.g., out-of-band AXI stimulus or staged sequencing) to guarantee at least one low pulse.
- Extend the monitor with debug logging hooks once the first low transition appears, so we can timestamp the deassertion/reassertion cycle for future coverage analysis.
