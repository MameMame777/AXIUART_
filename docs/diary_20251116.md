# Diary 2025-11-16

## Context

Executed directed DSIM regressions requested by user (basic, basic_115200, reg_rw) after DSIM_HOME normalization patch. Goal: capture current failure modes and collect artifacts for analysis.

## Commands

1. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_test --mode run --verbosity UVM_MEDIUM --waves --timeout 300`
   - Status: PASS
   - Artifacts: `sim/exec/logs/uart_axi4_basic_test_20251116_200016.log`, `archive/waveforms/uart_axi4_basic_test_20251116_200016.mxd`
   - Notes: Coverage 33.79% (<80% goal). Persistent DSIM warnings (IneffectiveDynamicCast, MissingTimescale, ReadingOutputModport, MultiBlockWrite)

2. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_115200_test --mode compile --verbosity UVM_LOW --timeout 180`
   - Status: PASS
   - Artifact: `sim/exec/logs/uart_axi4_basic_115200_test_20251116_200131.log`
   - Notes: Compile-only; same warnings as basic test.

3. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_115200_test --mode run --verbosity UVM_MEDIUM --waves --timeout 300`
   - Status: FAIL (UVM_FATAL `UART_DRIVER_TIMEOUT`)
   - Artifact: Log not emitted under `sim/exec/logs` despite DSIM reporting path `uart_axi4_basic_115200_test_20251116_200156.log`; waveform `archive/waveforms/uart_axi4_basic_115200_test_20251116_200156.mxd`
   - Notes: Timeout at 11,110,400 ns waiting for monitor response while DUT remained silent after baud reconfiguration.

4. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_test_reg_rw --mode compile --verbosity UVM_LOW --timeout 180`
   - Status: PASS
   - Artifact: `sim/exec/logs/uart_axi4_basic_test_reg_rw_20251116_200256.log`
   - Notes: Only compile; same warning set.

5. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_test_reg_rw --mode run --verbosity UVM_MEDIUM --waves --timeout 300`
   - Status: FAIL (tool timeout)
   - Artifact: `sim/exec/logs/uart_axi4_basic_test_reg_rw_20251116_200355.log`, waveform request aborted with timeout
   - Notes: Simulation progressed through hundreds of register transactions and produced TX responses, but DSIM exceeded wall-clock 300s window; run terminated by MCP client without final UVM report. Needs segmentation or targeted stimulus to finish within timeout.

## Findings

- Environment stable; DSIM_HOME normalization effective. Persistent compile warnings still present and should be triaged separately.
- `uart_axi4_basic_test` remains green but coverage insufficient.
- `uart_axi4_basic_115200_test` reproducibly hits `UART_DRIVER_TIMEOUT` waiting for TX response post high-baud write. Requires waveform/log analysis to identify handshake stall (likely TX path or monitor gating).
- `uart_axi4_basic_test_reg_rw` overwhelms 300s wall-clock limit; needs runtime reduction (fewer register iterations or faster host) or infrastructure change (extend timeout with justification).
- Missing log for 115200 run indicates DSIM aborted before flushing file; confirm with MCP tooling.

## Next Steps

1. Analyze `uart_axi4_basic_115200_test` waveform (`archive/waveforms/uart_axi4_basic_115200_test_20251116_200156.mxd`) to locate last UART activity and root-cause timeout.
2. Profile `uart_axi4_basic_test_reg_rw` runtime; throttle sequence length or refactor to chunked phases so runs complete within tool timeout, or justify increasing limit.
3. Address structural warnings: Missing timescales, illegal modport reads, FIFO write conflicts, and coverage target gap.

## Session 2025-11-16 PM (Monitor FIFO Instrumentation)

### Context (Instrumentation Run)

Re-ran `uart_axi4_basic_115200_test` after enabling forced FIFO publish logging inside `sim/uvm/agents/uart/uart_monitor.sv`. Goal: confirm analysis-port activity and capture enhanced telemetry around the persistent driver timeout.

### Commands (Instrumentation Run)

1. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_115200_test --mode compile --verbosity UVM_LOW --timeout 120`
   - Status: PASS
   - Artifact: `sim/exec/logs/uart_axi4_basic_115200_test_20251116_202250.log`
   - Notes: Clean compile; warning set unchanged.

2. `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_115200_test --mode run --verbosity UVM_MEDIUM --waves --timeout 300`
   - Status: FAIL (UVM_FATAL `UART_DRIVER_TIMEOUT`)
   - Artifacts: `sim/exec/logs/uart_axi4_basic_115200_test_20251116_202317.log`, `archive/waveforms/uart_axi4_basic_115200_test_20251116_202317.mxd`
   - Notes: Fatal at 11,828,672 ns; monitor RX publish logs confirm continuous `0x00` pushes and no TX publish before timeout.

### Observations

- Monitor instrumentation working: saw `UART_MONITOR_FIFO RX` and `UART_MONITOR_TX_PUBLISH` tags in log up to the stall point.
- Second baud configuration write finishes, but RX stream degenerates to constant zeros while AXI bridge remains in `MAIN_IDLE`; TX remains silent, triggering driver watchdog.
- Attempted to add diary entry via new file creation; rejected because `docs/diary_20251116.md` already existed.

### Follow-up

1. Inspect `Uart_Axi4_Bridge.sv` baud-change handling to ensure RX sampler exits reset cleanly at 115200 baud.
2. Correlate RX zeros with bridge state machine transitions using waveform `...202317.mxd`.
3. Prepare targeted assertions around RX idle detection to flag stuck-low conditions earlier.

## Session 2025-11-16 PM (Idle Guard Implementation)

### Context (Idle Guard)

Implemented host-side mitigations to prevent CONFIG write responses from colliding with the follow-on debug transaction. Added UART idle guard waits in `uart_axi4_basic_115200_test` and initialized CTS to a known level in the top-level testbench.

### Changes

- `sim/uvm/tests/uart_axi4_basic_115200_test.sv`: added `wait_for_uart_quiescent()` helper and invoked it before/after baud override programming to enforce a quiescent window on both RX/TX lines.
- `sim/uvm/tb/uart_axi4_tb_top.sv`: initialized `uart_cts_n` to deasserted high until the driver configures the interface, avoiding X propagation into the DUT.

### Verification

- `python mcp_server/mcp_client.py --workspace E:\Nautilus\workspace\fpgawork\AXIUART_ --tool run_uvm_simulation --test-name uart_axi4_basic_115200_test --mode compile --verbosity UVM_LOW --timeout 180`
   - Status: PASS
   - Artifact: `sim/exec/logs/uart_axi4_basic_115200_test_20251116_204755.log`
   - Notes: No new compile issues; standing DSIM warnings unchanged.

### Next Steps (Idle Guard)

1. Re-run full `uart_axi4_basic_115200_test` with waves to confirm the idle guard eliminates RX/TX contention and clears `UART_DRIVER_TIMEOUT`.
2. If timeout persists, instrument `Uart_Axi4_Bridge` internal state (baud FSM, FIFO flush) to decide whether RTL fixes are required in addition to TB guards.
