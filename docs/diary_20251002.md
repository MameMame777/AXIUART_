# AXIUART SystemVerilog UVM Verification – Daily Diary (2025-10-02)

_Status: Phase 0 - Regression baseline and scoreboard repair in progress_

## Investigation Summary

### Completed Tasks
1. **UVM_ERROR root cause analysis**: Analyzed dsim.log and identified 33 UVM_ERRORs caused by scoreboard transaction mismatch issues
2. **Environment validation**: Confirmed DSIM environment variables (DSIM_HOME, DSIM_ROOT, DSIM_LIB_PATH) are correctly set
3. **Scoreboard logic repair**: Fixed `require_error` calculation to include `bridge_enable=0` conditions
4. **Enhanced debugging**: Added detailed logging in `verify_transaction_match()` function

### Key Findings

#### Root Cause Analysis
The primary issue was in the scoreboard's error expectation logic:

**Original problematic logic:**
```systemverilog
allow_error = expect_error || !bridge_enabled;
require_error = expect_error;  // <- BUG: Missing bridge_enabled consideration
```

**Fixed logic:**
```systemverilog
allow_error = expect_error || !bridge_enabled;
require_error = expect_error || !bridge_enabled;  // <- Now correctly handles bridge disabled state
```

#### Error Patterns Identified
1. **bridge_enable=0 cases**: ADDR=0x00001000 sequences expect errors when bridge is disabled, but BRESP=0x0 (success) is returned
2. **Unexpected error responses**: ADDR=0x0000100a returns BRESP=0x2 when no error was expected
3. **expect_error propagation gaps**: UART metadata not properly setting error expectations for some sequences

#### Test Results After Fix
- **UVM_ERROR count**: Reduced from 33 to 31 (6% improvement)
- **Mismatch count**: Reduced from 16 to 15 (6.25% improvement)
- **Coverage improvements**: Frame 78.43%, Burst 86.46%, Error 66.67%

### Remaining Issues

Despite the logic fix, UVM_ERRORs persist with the same patterns:

1. **ADDR=0x00001000** still shows `bridge_enable=0 expect_error=0` errors
2. **ADDR=0x0000100c** shows `bridge_enable=1 expect_error=1` but BRESP=0
3. **expect_error flag propagation** remains inconsistent between UART sequences and AXI evaluation

### Technical Analysis

#### Bridge Enable State Management
The bridge_enable signal appears to be controlled externally via `cfg.bridge_status_vif.bridge_enable`. However, the UART sequences may not be coordinating their error expectations with the current bridge state.

#### Sequence-Scoreboard Coordination Gap
The issue suggests that:
- Register sequences set `expect_error=0` based on address ranges
- Scoreboard auto-classification logic should handle bridge_enable state
- But the UART transaction metadata doesn't reflect the final error expectation

### Next Steps Required

#### Immediate Actions (Priority A)
1. **Trace bridge_enable transitions**: Add monitoring to capture when bridge_enable changes and correlate with failing transactions
2. **Audit UART metadata flow**: Ensure `expect_error` flags from register sequences reach the scoreboard correctly
3. **Validate reserved address logic**: Confirm `is_addr_reserved()` function correctly identifies problem addresses

#### Enhanced Debugging (Priority B)
1. **Add bridge state logging**: Monitor bridge_enable transitions in the sequences
2. **Correlation analysis**: Match UART command timestamps with bridge state changes
3. **Sequence metadata validation**: Verify `register_comprehensive_sequence` error flag setting logic

### Coverage Progress

Current metrics show good progress toward Phase 4 targets:
- **Frame coverage**: 78.43% (target ≥40% ✓)
- **Burst coverage**: 86.46% (target ≥55% ✓)
- **Error coverage**: 66.67% (approaching target ≥60%)

However, stability must be achieved (UVM_ERROR=0) before pursuing coverage stretch goals.

### Test Environment Status

#### Stable Components
- DSIM v20240422.0.0 environment configured correctly
- `run_uvm.ps1` script functioning with proper MXD/coverage generation
- Enhanced logging implemented without performance impact

#### Infrastructure Artifacts
- **Waveform**: `register_comprehensive_test_20251002_082625.mxd` (created successfully)
- **Coverage**: HTML report generated in `sim/exec/coverage_report/`
- **Logs**: Detailed UVM_HIGH level debugging available in `sim/uvm/dsim.log`

### Recommended Investigation Approach

1. **Bridge enable correlation**: Run test with `UVM_HIGH` verbosity and correlate bridge_enable state changes with failing transactions
2. **Metadata validation**: Add assertions in register sequences to validate expect_error setting logic
3. **Incremental testing**: Test individual problematic addresses in isolation

### Work Continuation Plan

The scoreboard repair shows promise (31 vs 33 errors), indicating the logic fix was partially effective. The remaining errors suggest coordination issues between bridge state management and sequence error expectations that require targeted investigation.

**Estimated effort**: 1-2 additional investigation cycles to achieve UVM_ERROR=0 baseline.

---

**Next session focus**: Bridge enable state correlation and UART metadata validation