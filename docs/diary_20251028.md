# Development Diary - 2025-10-28

## Task

- Diagnose the persistent `bridge_busy` hang seen in `uart_axi4_basic_test` runs.
- Implement a production-ready fix inside `Uart_Axi4_Bridge` so the design recovers autonomously.

## Findings

- The bridge instantiated `Frame_Parser` with `ENABLE_TIMEOUT` forced low. When the host aborts mid-frame the parser never advances to `VALIDATE` or `ERROR`, leaving `parser_busy` asserted indefinitely.
- `bridge_busy` is derived from `parser_busy`, so the disabled timeout propagated into a system-wide stall that only cleared when the simulation watchdog killed DSIM.

## Changes

- Exposed timeout controls through new bridge parameters and re-enabled the parser watchdog by default.
- Tightened the parser stall assertion to depend on the active timeout window and added focused debug telemetry for timeout-driven error responses.

## Verification

- Compilation pending; rerun `DSIM: Run Basic Test (Compile Only - MCP)` then `DSIM: Run Basic Test (Full Simulation - MCP)` to confirm the timeout now yields a `STATUS_TIMEOUT` response instead of a hang.

## Follow-up

- If longer inter-byte gaps are required in future tests, adjust `PARSER_TIMEOUT_BYTE_TIMES` via the bridge parameter instead of disabling the watchdog.

## Update - Diagnostics Threshold Alignment

- Bound `emergency_frame_parser_diagnostics` with `MAX_STATE_STABLE_CYCLES` equal to the parser `TIMEOUT_CLOCKS` to eliminate false positives while UART bytes are still shifting in.
- Recompiled the testbench with `DSIM: Run Basic Test (Compile Only - MCP)` and re-ran the MCP `run_uvm_simulation` command in run mode with waves enabled.
- Assertion spam is gone, confirming the diagnostic window now matches the design timeout; however, `uart_axi4_basic_test` still hits the 300 s DSIM watchdog (log: `sim/exec/logs/uart_axi4_basic_test_20251028_202919.log`).
- Next: Inspect the generated waveform (`archive/waveforms/uart_axi4_basic_test_20251028_202919.mxd`) to locate the handshake that stalls shortly after the second received byte.
