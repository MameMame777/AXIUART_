# AXIUART Verification Diary – 2025-09-29

## Summary

- Diagnosed the persistent CONTROL-disable failures to a UART receive bit-order defect that corrupted high-bit commands before the frame parser consumed them.
- Corrected the `Uart_Rx` data capture logic so sampled bits map directly to their intended bit positions instead of being left-shifted.
- Re-ran `register_comprehensive_test` to confirm CRC mismatches no longer occur; the bridge now decodes command `0x63` correctly, though monitor-level timeout errors remain for follow-up analysis.

## Root Cause Analysis

- The existing receiver shifted the register left and appended the latest sampled value onto bit 0.
- Because UART traffic is LSB-first, this approach effectively multiplied every byte by two (`value << 1`) before the CRC calculator observed it.
- The frame parser therefore saw command `0x63` as `0xC6`, causing the expected data length, CRC accumulation, and command echo fields to desynchronize; this propagated as CRC error status `0x01` responses.

## Implementation Details

- Updated `rtl/Uart_Rx.sv` in the `DATA_BITS` state to store the sampled bit directly into `rx_shift_reg_next[bit_counter]` instead of shifting.
- Retained debug instrumentation so the waveform/log now prints both the previous and updated shift-register values with the corrected bit placement.
- No other RTL or UVM components required modification; CRC calculator and parser logic already handled the correctly ordered data.

## Verification

- Command: `sim/exec/run_uvm.ps1 -Mode run -TestName register_comprehensive_test -Verbose UVM_MEDIUM` executed from `sim/exec`.
- Result: Simulation terminates with the existing monitor timeouts (`UVM_ERROR = 3`) and top-level timeout guard at 400 ms, but the prior CRC mismatch log entries are absent.
- Waveform: `archive/waveforms/register_comprehensive_test_20250929_064826.mxd` captures the post-fix behavior for further analysis.
- Observation: Parser debug messages now show `parser_cmd=0x63` and `expected_bytes=16` for the CONTROL write, confirming the byte ordering fix; remaining errors stem from downstream CONTROL sequencing and will be handled next.

## Follow-up Recommendations

- Use the cleaned UART feed to focus on the outstanding CONTROL disable timing issue—instrument the AXI-lite handshake and bridge enable strobes now that command decoding is trustworthy.
- Add an assertion in `Uart_Rx` that fires if the sampled byte equals its left-shifted variant (e.g., repeating start bit) to prevent regressions in bit ordering.
- Consider unit-level self-checking for the UART receiver that injects known patterns (0x55, 0xAA, 0x63, 0xC6) to guarantee LSB-first assembly behavior under simulation.

---

## Disable Regression Wrap-up – 2025-09-29 PM

### Objective
Validate the refined scoreboard transaction-type filtering and confirm the CONTROL disable/enable cycle now executes without false mismatches.

### Actions
- Re-executed `uart_axi4_register_block_test` after consolidating the `uart_is_write` flag declaration inside `uart_axi4_scoreboard::check_for_matches`.
- Monitored the bridge FSM to confirm `MAIN_DISABLED_RESPONSE` returns status `0x06` while gating non-CONTROL traffic during the disabled window.
- Reviewed UART/AXI debug prints to ensure CONTROL writes at address `0x00001000` propagate correctly through the register block while the bridge toggles `bridge_enable`.

### Results
- Test finished with `UVM_ERROR: 0`; warnings limited to coverage (< 80%) and expected unmatched UART status frames.
- Scoreboard summary reported 17 matches and 0 mismatches, eliminating the prior CONTROL disable false positives.
- Coverage snapshot: frame 29.55%, burst 28.13%, error 50.00%, total 35.89%; waveform stored as `sim/uvm/uart_axi4_register_block_test.mxd`.

### Insights
- Address/type filtering in the scoreboard is sufficient; the residual unmatched UART frames are status responses lacking AXI counterparts—candidate for future response-tracking enhancement.
- Bridge disable path now proves deterministic: CONTROL write to zero asserts the disabled-response state immediately, and re-enable write restores normal operation without AXI stalls.

### Next Steps
1. Extend regression suite with additional disable window variations to raise coverage toward the 80% goal.
2. Evaluate augmenting the scoreboard with a response queue so informational warnings about unmatched UART frames can be suppressed or downgraded.
3. Sync the findings into the verification plan and register block documentation after coverage improvements are in place.
